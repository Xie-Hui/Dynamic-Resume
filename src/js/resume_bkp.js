var cv = {
    "logo":"",
    "name":"Hui Xie",
    "title":"Computational Designer",
    "intro":"Study architure before, specialize in computational design and fabrication. Eager to learn, like programming.",

    "educationBackground":{
        "title":"Background",

        "graduate":{
            "time":"2015.9-2017.7",
            "school":"School of Architecture, Tsinghua University",
            "degree":"Master of Architecture",
            "gpa":"GPA 3.58/4",
            "courses":"Course: Big Data Analytic, Human-Computer Interaction"
        },
        "minor":{
            "time":"2012.9-2015.7",
            "school":"Department of Computer Science and Technology, Tsinghua University",
            "degree":"Computer Technology Minor",
            "gpa":"GPA 92/100",
            "courses":"Cource: Software Engineering, Computer-Aided Design, Data Structure, C++ Programing, Computer Architecture"
        },
        "undergraduate":{
            "time":"2011.9-2015.7",
            "school":"School of Architecture, Tsinghua University",
            "degree":"Bachelor of Architecture",
            "gpa":"GPA 90/100",
            "courses":"Cource: Fine Art, Calculus, Architecture Design."
        }
    },

    "projects":{
        "title":"Projects",

        "issuu_monitor":{
            "name":"Issuu Crawler",
            //"link":"",
            "brief":"A Issuu crawler to find most liked portfolios",
            "intro":"using urllib+re to realize Issuu.com crawler，find and sort best portfolios and download them",
            "skill":["Python"],
            "github":"https://github.com/maajor/IssuuPortfolioCrawler",
            "zhihu":"https://www.zhihu.com/question/38438713/answer/85073618?from=profile_answer_card"
        },

        "vp3dp":{
            "name":"Fused Synergy",
            //"link":"",
            "brief":"Various-property FDM spatial printing with robotic arm",
            "intro":"Mix and extrude multiple materials, freeform spatial printing using robot",
            "skill":["Arduino", "Kuka Robot"],
            "behance":"https://www.behance.net/gallery/33713362/VP3DP-Robot",
        },

        "physarealm":{
            "name":"Physarealm",
           // "link":"",
            "brief":"Biomimic formfinding inspired by slime mold",
            "intro":"Research slime mold's foraging behavior, using agent-based modelling technique to simulate and develop into archtecture form.",
            "skill":["C#", "Grasshopper", "Photoshop", "Rhino"],
            "github":"https://github.com/maajor/Physarealm",
            "behance":"https://www.behance.net/gallery/33713844/Physarealm",
            "food4rhino":"http://www.food4rhino.com/project/physarealm?ufh"
        },

        "elders_ambition":{
            "name":"Elder's Ambition",
           // "link":"",
            "brief":"A Magic Tower-like RPG game to rescue software engineering's world",
            "intro":"Best project of 2014 Software Engineering Course. I am responsible for UI/UX design.",
            "skill":["Photoshop" , "Qt", "C++"],
            "github":"https://github.com/a-serious/elders-ambition",
            "se2014":"http://soft.cs.tsinghua.edu.cn/blog/?q=se2014"
        },

        "ife":{
            "name":"Baidu IFE",
           // "link":"",
            "brief":"Participate IFE to learn Front-end engineering skills.",
            "intro":"Making a native javascript image showcase library 'm-album' in final project",
            "skill":["HTML" , "CSS", "Javascript"],
            "github":"https://github.com/xuteam"
        },

        "fingerprint":{
            "name":"Fingerprint on Painting",
           // "link":"",
            "brief":"HCI Course Project",
            "intro":"Finetune CNN to recognize style and artist of paintings",
            "skill":["Python" , "Caffe"],
            "github":"https://github.com/THU-HCI2016-MLGroup/FingerprintOnPaintings"
        }

    },


    "awards":{
        "title":"Awards",

        "excellent":{
            "time":2016,
            "name":"Excellent Graduate of Tsinghua University",
            "institution":"Tsinghua University",
            "intro":"Awarded to top 10% of graduates."
        },

        "dada":{
            "time":2015,
            "name":"DADA2015 Best Student Paper",
            "institution":"Digital Architecture Design Association, Architect Branch, Architectural Society of China",
            "intro":"Title: Parametric Design and Fabrication of Irregular Scissor-Pair Structure，only undergraduate receiver."
        },

        "evolo":{
            "time":2014,
            "name":"Evolo Skyscraper Competition Honorable Mention",
            "institution":"eVolo Magazine",
            "intro":"Concept architecture competition，receipient: 20/600+ entries. Responsible for modelling and rendering."
        },

        "national_award":{
            "time":2012,
            "name":"National Scholarship",
            "institution":"Ministry of Education of the People's Republic of China",
            "intro":"For outstanding academic performance in freshman year. GPA 1/96"
        },

        "software_award":{
            "time":2014,
            "name":"Best project for 2014's Software Engineering Course",
            "institution":"2014 Software Engineering Course",
            "intro":"Project\"Elder's Ambition\"，responsible for UI/UX deign"
        },

        "innovation_award":{
            "time":2014,
            "name":"Innovation Awards",
            "institution":"Tsinghua University",
            "intro":"Receive for many inovations in junior year."
        },

    },

    "workExperience":{
        "title":"Experience",


        "netease":{
            "time":"2016.7-2016.9",
            "position":"Technical Artist Intern",
            "company":"NetEase Game",
            "role":"Procedural modelling of sandtable scene, make procedureal terrain generation pipeline for artist, experiment on procedural generation of traditional chinese architecture."
        },

        "xwg":{
            "time":"2015.9-",
            "position":"Assistant Architect",
            "company":"XWG Archi-studio",
            "role":"Parametric modelling and rendering"
        },

        "shanghai":{
            "time":"2015.5-2015.8",
            "position":"Architecture Intern",
            "company":"Shanghai Xian Dai Architectural Design (Group)Co.,Ltd",
            "role":"Parametric modelling and rendering"
        },

        "freelancer":{
            "time":"2014.9-",
            "position":"",
            "company":"Freelancer(part-time)",
            "role":"programming, modelling, rendering and design work."
        }
    },

    "skills":{
        "title":"Skills",

        "modelling":{
            "name":"3D Modelling",
            "proficency":"Expert",
            "intro":"4 year experience using Rhinoceros, Confident with Maya and 3dsMax。"
        },

        "unity":{
            "name":"Game Engine",
            "proficency":"Proficent",
            "intro":"Write Unity scripts and Shader，familier with asset optimization methods"
        },

        "pcg":{
            "name":"Procedural Generating Contents",
            "proficency":"Expert",
            "intro":"Expert with WorldMachine, SpeedTree and CityEngine"
        },

        "frontend":{
            "name":"Front End Tools",
            "proficency":"Familier",
            "intro":"can write semantic HTML，know new features in CSS3，proficient with JQuery，know some Three.js"
        },

        "design":{
            "name":"2D Graphic",
            "proficency":"Expert",
            "intro":"many year's experience in Photoshop、Illustrator and Indesign"
        },

        "prototype":{
            "name":"Prototype",
            "proficency":"Proficent",
            "intro":"Proficient with Arduino interation，have basic electronic circuit knowledge，able to create 3dprint machine parts"
        },

        "coding":{
            "name":"Coding",
            "proficency":"Proficent",
            "intro":"Good at develop C# plugin for Rhinoceros，Familier with Unity3D script，have experience in data analysis and web crawler，know about MEL, HLSL and GLSL"
        }
    }

}

var nodePositions = {};
var auxBoxes = {};
var oriTarget = new THREE.Vector3(0,0,6000);
var oriFrom = new THREE.Vector3(0,0,7500);
var icons = {
    "github":"fa fa-github",
    "zhihu":"fa fa-comment",
    "behance":"fa fa-behance",
    "se2014":"fa fa-graduation-cap",
    "food4rhino":"fa fa-bug",
    "baidu":"fa fa-terminal"
}
var section_item_r = [300,300,300,300,400,450,350,300,300,300,300];
var cv_objects = {
    "educationBackgroundObjects":[],
    "educationBackgroundDesired":[],
    "projectsObjects":[],
    "projectsDesired":[],
    "awardsObjects":[],
    "awardsDesired":[],
    "workExperienceObjects":[],
    "workExperienceDesired":[],
    "skillsObjects":[],
    "skillsDesired":[],
};

function createCvElements(){

    var container = document.getElementById("container");

    var namecardNode = document.createElement("div");
    namecardNode.className = "namecard"+"-container";
    //container.appendChild(namecardNode);

    var cvKeys = Object.keys(cv);
    //console.log(cvKeys.length);
    var return_but = "Return";

    for(var i = 0; i < cvKeys.length; i++){
        var cvitem_name = cvKeys[i];
        var SectionObject = cv[cvitem_name];
        if(SectionObject instanceof Object){ //if sectionObject is a valid object e.g. has multiple entries contents
            console.log(SectionObject);
            var thisKeys = Object.keys(SectionObject);//name, prohect1, project2.....

            //create element for this section, ie projects, educationBackground etc.
            var thisSectionNode = document.createElement("div");
            thisSectionNode.className = cvitem_name +"-container";
            //thisSectionNode.className = "cvsection-name-container";
            container.appendChild(thisSectionNode);

            var thisSectionNavNode = document.createElement("div");
            thisSectionNavNode.className = cvitem_name + "-container";
            //console.log(SectionObject);
            var temp_name = thisKeys[0];
            var tempNode = document.createElement("div");
            tempNode.className = cvitem_name +"-"+ temp_name;
            /*
            var iconNode = document.createElement("i");
            iconNode.className = "fa fa-list-alt fa-lg";
            thisSectionNavNode.appendChild(iconNode);
            console.log(iconNode);
            */
            tempNode.textContent = SectionObject[temp_name];
            thisSectionNavNode.appendChild(tempNode);
            container.appendChild(thisSectionNavNode);
            //console.log(tempNode.textContent);


            //navigation-block
            var len = cvKeys.length;
            //console.log(cvKeys);
            var r = 180 + Math.random() * 50;
            var theta = Math.random() * (6/len) + i * (12/len);
            var navX = 900 - 150 * i;
            var navY =  -220;
            var navZ = 6000;

            var object = new THREE.CSS3DObject( thisSectionNavNode );
            object.position.x = navX;
            object.position.y = navY;
            object.position.z = navZ;
            scene.add( object );

            //section-block
            var sectionr = 3000 + Math.random() * 1000;
            //var sectiontheta = Math.random() * (6/len) + i * (12/len);
            var sectiontheta = 6 * (12/len);
            var thisSectionX = Math.sin(sectiontheta) * sectionr;
            var thisSectionY = Math.cos(sectiontheta) * sectionr;
            var thisSectionZ = Math.random() * 1000 + 2000;
            var newPosition = new THREE.Vector3(thisSectionX,thisSectionY,thisSectionZ)

            var faceX = thisSectionX +  Math.random() * 1000 - 500;
            var faceY = thisSectionY +  Math.random() * 1000 - 500;
            var faceZ = thisSectionZ + 1500 ;
            var faceTarget= new THREE.Vector3(faceX, faceY,faceZ);

            var randomPos = new THREE.Vector3((Math.random() * 10000 + 10000) * (Math.random() > 0.5 ? 1: -1),
                (Math.random() * 10000 + 10000) * (Math.random() > 0.5 ? 1: -1),
                Math.random() * 5000 - 5000) ;
            var randomTarget = new THREE.Vector3(Math.random() * 8000 - 4000,
                Math.random() * 8000 - 4000,
                Math.random() * 5000) ;

            var obj = new THREE.CSS3DObject( thisSectionNode );
            obj.position.copy(randomPos);
            obj.lookAt(randomTarget);
            scene.add( obj );

            var objDesire = new THREE.CSS3DObject( thisSectionNode );
            objDesire.position.copy(newPosition);
            objDesire.lookAt(faceTarget);

            //console.log(cvitem_name+"Objects");
            cv_objects[cvitem_name+"Objects"].push(obj);
            cv_objects[cvitem_name+"Desired"].push(objDesire);


            nodePositions[thisSectionNode.className+"target"] = objDesire;
            nodePositions[thisSectionNode.className+"vector"] = faceTarget;
            nodePositions[thisSectionNode.className+"name"] = cvitem_name;

            thisSectionNavNode.addEventListener("click", function(){
                var targetObject = nodePositions[this.className+"target"];
                var targetVector = nodePositions[this.className+"vector"];
                var targetName = nodePositions[this.className+"name"];
                //transform(targetObject.position,targetVector, 1500);
                flyTo(targetObject.position,targetVector, targetName, 1000);
            }, false);

            thisSectionNode.addEventListener("click", function(){
                var targetName = nodePositions[this.className+"name"];
                //transform(oriTarget,oriFrom, 1500);
                flyAway(oriTarget,oriFrom, targetName, 1000);
            }, false);

             //console.log(SectionObject);

             //cv sections such as workexpericence, project, background
            for(var j = 0; j < thisKeys.length; j++){
                var cvsection_name = thisKeys[j];
                var SectionItemObject = SectionObject[cvsection_name];

                //item for cv-section
                if(SectionItemObject instanceof Object){

                    var sectionItemNames = Object.keys(SectionItemObject);

                    var thisSectionItemNode = document.createElement("div");
                    thisSectionItemNode.className = cvitem_name +"-item-container";
                    container.appendChild(thisSectionItemNode);
                    //console.log(SectionItemObject);
                    //console.log(sectionItemNames);

                    for(var k = 0; k < sectionItemNames.length; k++){
                        var itemName = sectionItemNames[k];

                        var thisNode = document.createElement("div");
                        if(Object.keys(icons).indexOf(itemName) != -1){
                            thisNode.className = "cv-item-icon";
                            var hyperlink = document.createElement("a");
                            hyperlink.href = SectionItemObject[itemName];
                            hyperlink.target = "_blank"
                            var iconNode = document.createElement("i");
                            iconNode.className = icons[itemName];
                            hyperlink.appendChild(iconNode);
                            thisNode.appendChild(hyperlink);
                            thisSectionItemNode.appendChild(thisNode);
                            //console.log(icons[itemName]);
                        }
                        else{
                            thisNode.className = cvitem_name +"-" + itemName;
                            thisNode.textContent = SectionItemObject[itemName];
                            //console.log(thisNode.textContent);
                        }
                        thisSectionItemNode.appendChild(thisNode);


                    }
                    var lenItems = thisKeys.length;
                    var r = section_item_r[i] + Math.random() * 50;
                    var theta = Math.random() * (1/lenItems) + (j + 0.5) * (6.3/lenItems);
                    //console.log(thisSectionItemNode);
                    //console.log(r);

                    var thisPosition = new THREE.Vector3(thisSectionX + Math.sin(theta) * r,
                        thisSectionY + Math.cos(theta) * r,
                        thisSectionZ + Math.random() * 300 - 500)

                    var randomItemPos = new THREE.Vector3((Math.random() * 10000 + 10000) * (Math.random() > 0.5 ? 1: -1),
                        ( Math.random() * 10000 + 10000 ) * ( Math.random() > 0.5 ? 1: -1 ),
                        Math.random() * 5000 - 5000) ;
                    var randomItemTarget = new THREE.Vector3(Math.random() * 8000 - 4000,
                        Math.random() * 8000 - 4000,
                        Math.random() * 5000) ;


                    var object = new THREE.CSS3DObject( thisSectionItemNode );
                    object.position.copy(randomItemPos);
                    object.lookAt(randomItemTarget);
                    scene.add( object );

                    var objItemDesire = new THREE.CSS3DObject( thisSectionNode );
                    objItemDesire.position.copy(thisPosition);
                    objItemDesire.lookAt(faceTarget);

                    cv_objects[cvitem_name+"Objects"].push(object);
                    cv_objects[cvitem_name+"Desired"].push(objItemDesire);
                    //console.log(cv_objects);

                }

                //title for cv-section
                else{
                    var thisNode = document.createElement("div");
                    thisNode.className = cvitem_name +"-" + cvsection_name;
                    thisNode.textContent = "Return";
                    //thisNode.textContent = SectionObject[cvsection_name];
                    thisSectionNode.appendChild(thisNode);
                }

            }

        }

        //cv-basic infos such as name, title, self-intro
        else{
            var thisNode = document.createElement("div");
            thisNode.className = "namecard-"+cvitem_name;

            thisNode.textContent = cv[cvitem_name];
            namecardNode.appendChild(thisNode);
        }
    }

    var object = new THREE.CSS3DObject( namecardNode );
    object.position.x = 0;
    object.position.y = 0;
    object.position.z = 6000;
    scene.add( object );

    var object = new THREE.Object3D();
    object.position.x = 0;
    object.position.y = 0;
    object.position.z = 6000;

}
