var cv = {
    "logo":"",
    "name":"马逸东",
    "title":"前端工程师 | 运算化设计师",
    "intro":"曾学习建筑学，擅长参数化设计与数字建造。善于学习，喜欢编程，希望能成为前端工程师。",
    
    "educationBackground":{
        "title":"教育背景",

        "graduate":{
            "time":"2015.9-2017.7",
            "school":"清华大学建筑学院",
            "degree":"建筑学硕士",
            "gpa":"GPA 3.58/4",
            "courses":"参加课程: 大数据分析、人机交互"
        },
        "minor":{
            "time":"2012.9-2015.7",
            "school":"清华大学计算机系",
            "degree":"计算机技术辅修",
            "gpa":"GPA 92/100",
            "courses":"参加课程: 软件工程、计算机辅助设计、数据结构、C++程序设计、计算机系统与组成结构"
        },
        "undergraduate":{
            "time":"2011.9-2015.7",
            "school":"清华大学建筑学院",
            "degree":"建筑学学士",
            //"gpa":"GPA 90/100",
            "courses":"参加课程: 素描水彩、微积分、建筑设计。担任班级生活与学习委员。获得过国家奖学金。"
        }
    },

    "projects":{
        "title":"项目经验",

        "issuu_monitor":{
            "name":"Issuu Crawler",
            //"link":"",
            "brief":"Issuu爬虫，寻找最赞作品集",
            "intro":"用urllib+re实现Issuu.com爬虫，寻找最赞作品集并排序以及下载",
            "skill":["Python"],
            "github":"https://github.com/maajor/IssuuPortfolioCrawler",
            "zhihu":"https://www.zhihu.com/question/38438713/answer/85073618?from=profile_answer_card"
        },

        "vp3dp":{
            "name":"VP3DP",
            //"link":"",
            "brief":"多材质机械臂空间FDM打印",
            "intro":"将多种材料混合挤出，用机械臂控制实现空间自由打印",
            "skill":["Arduino", "Kuka Robot"],
            "behance":"https://www.behance.net/gallery/33713362/VP3DP-Robot",
        },

        "physarealm":{
            "name":"Physarealm",
           // "link":"",
            "brief":"黏菌仿生找形",
            "intro":"模仿黏菌觅食过程，实现Agent-Based Modelling找形，并发展为建筑形态",
            "skill":["C#", "Grasshopper", "Photoshop", "Rhino"],
            "github":"https://github.com/maajor/Physarealm",
            "behance":"https://www.behance.net/gallery/33713844/Physarealm",
            "food4rhino":"http://www.food4rhino.com/project/physarealm?ufh"
        },

        "elders_ambition":{
            "name":"长者之野望",
           // "link":"",
            "brief":"拯救软件工程世界的魔塔RPG游戏",
            "intro":"2014年软件工程课年度最佳作品，主要负责UI/UX设计",
            "skill":["Photoshop" , "Qt", "C++"],
            "github":"https://github.com/a-serious/elders-ambition",
            "se2014":"http://soft.cs.tsinghua.edu.cn/blog/?q=se2014"
        },

        "ife":{
            "name":"百度前端学院",
           // "link":"",
            "brief":"参加百度IFE学习前端技术",
            "intro":"正在进行中......",
            "skill":["HTML" , "CSS", "Javascript"],
            "github":"https://github.com/xuteam"
        }

    },


    "awards":{
        "title":"获奖",

        "dada":{
            "time":2015,
            "name":"DADA2015最佳学生论文奖",
            "institution":"中国建筑学会数字建筑专委会颁发",
            "intro":"数字建筑专委会国际会议论文。题目：不规则剪式铰的参数化设计与建造，唯一本科获奖者。"
        },

        "evolo":{
            "time":2014,
            "name":"Evolo摩天楼竞赛 荣誉提名",
            "institution":"evolo杂志社颁发",
            "intro":"国际建筑概念设计竞赛获奖，提名奖总共20/600+。主要负责建模与效果图制作。"
        },

        "national_award":{
            "time":2012,
            "name":"国家奖学金",
            "institution":"中国教育部颁发",
            "intro":"大一学期成绩优秀获奖"
        },

        "software_award":{
            "time":2014,
            "name":"软件工程课年度最佳项目",
            "institution":"软件工程全校通选课颁发",
            "intro":"项目\"长者之野望\"，主要负责UI/UX设计"
        },

        "innovation_award":{
            "time":2014,
            "name":"科技创新奖学金",
            "institution":"清华大学颁发",
            "intro":"大三学期参加科创活动成果较多，获得奖励"
        },

    },

    "workExperience":{
        "title":"工作经历",

        "xwg":{
            "time":"2015.9-",
            "position":"助理建筑师",
            "company":"XWG工作室",
            "role":"主要负责参数化建模与渲染"
        },

        "shanghai":{
            "time":"2015.5-2015.8",
            "position":"建筑实习生",
            "company":"上海市建筑设计研究院",
            "role":""
        },

        "freelancer":{
            "time":"2014.9-",
            "position":"",
            "company":"自由职业者(兼职)",
            "role":"从事程序开发、建模、渲染、建筑设计等工作"
        }
    },

    "skills":{
        "title":"技能",

        "html":{
            "name":"HTML/CSS",
            "proficency":"熟练",
            "intro":"能够编写语义化HTML，了解HTML5和CSS3新特性。熟悉Sass预处理。能够用Bootstrap快速开发"
        },

        "javascript":{
            "name":"Javascript",
            "proficency":"熟练",
            "intro":"熟悉JQuery，会用Gulp构建项目。对React有初步了解"
        },

        "visulize":{
            "name":"可视化工具",
            "proficency":"熟悉",
            "intro":"会使用Three.js，熟练掌握Processing与Grasshopper"
        },

        "design":{
            "name":"设计工具",
            "proficency":"精通",
            "intro":"常年使用Photoshop、Illustrator和Indesign"
        },

        "python":{
            "name":"Python",
            "proficency":"熟悉",
            "intro":"对爬虫和数据处理有一定经验"
        },


        "csharp":{
            "name":"C#",
            "proficency":"熟练",
            "intro":"掌握C#Rhino二次开发，了解WPF"
        }
    }

}

var nodePositions = {};
var auxBoxes = {};
var oriTarget = new THREE.Vector3(0,0,6000);
var oriFrom = new THREE.Vector3(0,0,7500);
var icons = {
    "github":"fa fa-github",
    "zhihu":"fa fa-comment",
    "behance":"fa fa-behance",
    "se2014":"fa fa-graduation-cap",
    "food4rhino":"fa fa-bug",
    "baidu":"fa fa-terminal"
}
var section_item_r = [300,300,300,300,400,450,350,300,300,300,300];
var cv_objects = {
    "educationBackgroundObjects":[],
    "educationBackgroundDesired":[],
    "projectsObjects":[],
    "projectsDesired":[],
    "awardsObjects":[],
    "awardsDesired":[],
    "workExperienceObjects":[],
    "workExperienceDesired":[],
    "skillsObjects":[],
    "skillsDesired":[],
};

function createCvElements(){

    var container = document.getElementById("container");

    var namecardNode = document.createElement("div");
    namecardNode.className = "namecard"+"-container";
    //container.appendChild(namecardNode);


    var cvKeys = Object.keys(cv);
    //console.log(cvKeys.length);



    for(var i = 0; i < cvKeys.length; i++){
        var cvitem_name = cvKeys[i];
        var SectionObject = cv[cvitem_name];
        if(SectionObject instanceof Object){

            var thisKeys = Object.keys(SectionObject);//name, prohect1, project2.....

            //create element for this section, ie projects, educationBackground etc.
            var thisSectionNode = document.createElement("div");
            thisSectionNode.className = cvitem_name +"-container";
            //thisSectionNode.className = "cvsection-name-container";
            container.appendChild(thisSectionNode);

            var thisSectionNavNode = document.createElement("div");
            thisSectionNavNode.className = cvitem_name + "-container";
            //console.log();
            var temp_name = thisKeys[0];
            var tempNode = document.createElement("div");
            tempNode.className = cvitem_name +"-"+ temp_name;
            /*
            var iconNode = document.createElement("i");
            iconNode.className = "fa fa-list-alt fa-lg";
            thisSectionNavNode.appendChild(iconNode);
            console.log(iconNode);
            */
            tempNode.textContent = SectionObject[temp_name];
            thisSectionNavNode.appendChild(tempNode);
            container.appendChild(thisSectionNavNode);


            //nav-block
            var len = cvKeys.length;
            var r = 180 + Math.random() * 50;
            var theta = Math.random() * (6/len) + i * (12/len);
            var navX = 900 - 150 * i;
            var navY =  -220;
            var navZ = 6000;

            var object = new THREE.CSS3DObject( thisSectionNavNode );
            object.position.x = navX;
            object.position.y = navY;
            object.position.z = navZ;
            scene.add( object );

            //section-block
            var sectionr = 3000 + Math.random() * 1000;
            var sectiontheta = Math.random() * (6/len) + i * (12/len);
            var thisSectionX = Math.sin(sectiontheta) * sectionr;
            var thisSectionY = Math.cos(sectiontheta) * sectionr;
            var thisSectionZ = Math.random() * 1000 + 2000;
            var newPosition = new THREE.Vector3(thisSectionX,thisSectionY,thisSectionZ)

            var faceX = thisSectionX +  Math.random() * 1000 - 500;
            var faceY = thisSectionY +  Math.random() * 1000 - 500;
            var faceZ = thisSectionZ + 1500 ;
            var faceTarget= new THREE.Vector3(faceX, faceY,faceZ);

            var randomPos = new THREE.Vector3((Math.random() * 10000 + 10000) * (Math.random() > 0.5 ? 1: -1), 
                (Math.random() * 10000 + 10000) * (Math.random() > 0.5 ? 1: -1),
                Math.random() * 5000 - 5000) ;
            var randomTarget = new THREE.Vector3(Math.random() * 8000 - 4000, 
                Math.random() * 8000 - 4000,
                Math.random() * 5000) ;

            var obj = new THREE.CSS3DObject( thisSectionNode );
            obj.position.copy(randomPos);
            obj.lookAt(randomTarget);
            scene.add( obj );

            var objDesire = new THREE.CSS3DObject( thisSectionNode );
            objDesire.position.copy(newPosition);
            objDesire.lookAt(faceTarget);

            console.log(cvitem_name+"Objects");
            cv_objects[cvitem_name+"Objects"].push(obj);
            cv_objects[cvitem_name+"Desired"].push(objDesire);


            nodePositions[thisSectionNode.className+"target"] = objDesire;
            nodePositions[thisSectionNode.className+"vector"] = faceTarget;
            nodePositions[thisSectionNode.className+"name"] = cvitem_name;

            thisSectionNavNode.addEventListener("click", function(){
                var targetObject = nodePositions[this.className+"target"];
                var targetVector = nodePositions[this.className+"vector"];
                var targetName = nodePositions[this.className+"name"];
                //transform(targetObject.position,targetVector, 1500);
                flyTo(targetObject.position,targetVector, targetName, 1000);
            }, false);

            thisSectionNode.addEventListener("click", function(){
                var targetName = nodePositions[this.className+"name"];
                //transform(oriTarget,oriFrom, 1500);
                flyAway(oriTarget,oriFrom, targetName, 1000);
            }, false);

             //console.log(SectionObject);

             //cv sections such as workexpericence, project, background
            for(var j = 0; j < thisKeys.length; j++){
                var cvsection_name = thisKeys[j];
                var SectionItemObject = SectionObject[cvsection_name];

                //item for cv-section
                if(SectionItemObject instanceof Object){

                    var sectionItemNames = Object.keys(SectionItemObject);

                    var thisSectionItemNode = document.createElement("div");
                    thisSectionItemNode.className = cvitem_name +"-item-container";
                    container.appendChild(thisSectionItemNode);
                    //console.log(SectionItemObject);

                    for(var k = 0; k < sectionItemNames.length; k++){
                        var itemName = sectionItemNames[k];

                        var thisNode = document.createElement("div");
                        if(Object.keys(icons).indexOf(itemName) != -1){
                            thisNode.className = "cv-item-icon";
                            var hyperlink = document.createElement("a");
                            hyperlink.href = SectionItemObject[itemName];
                            hyperlink.target = "_blank"
                            var iconNode = document.createElement("i");
                            iconNode.className = icons[itemName];
                            hyperlink.appendChild(iconNode);
                            thisNode.appendChild(hyperlink);
                            thisSectionItemNode.appendChild(thisNode);
                            //console.log(icons[itemName]);
                        }
                        else{
                            thisNode.className = cvitem_name +"-" + itemName;
                            thisNode.textContent = SectionItemObject[itemName];
                        }
                        thisSectionItemNode.appendChild(thisNode);


                    }
                    var lenItems = thisKeys.length;
                    var r = section_item_r[i] + Math.random() * 50;
                    var theta = Math.random() * (1/lenItems) + (j + 0.5) * (6.3/lenItems);
                    //console.log(thisSectionItemNode);
                    //console.log(r);

                    var thisPosition = new THREE.Vector3(thisSectionX + Math.sin(theta) * r,
                        thisSectionY + Math.cos(theta) * r,
                        thisSectionZ + Math.random() * 300 - 500)

                    var randomItemPos = new THREE.Vector3((Math.random() * 10000 + 10000) * (Math.random() > 0.5 ? 1: -1), 
                        ( Math.random() * 10000 + 10000 ) * ( Math.random() > 0.5 ? 1: -1 ),
                        Math.random() * 5000 - 5000) ;
                    var randomItemTarget = new THREE.Vector3(Math.random() * 8000 - 4000, 
                        Math.random() * 8000 - 4000,
                        Math.random() * 5000) ;


                    var object = new THREE.CSS3DObject( thisSectionItemNode );
                    object.position.copy(randomItemPos);
                    object.lookAt(randomItemTarget);
                    scene.add( object );

                    var objItemDesire = new THREE.CSS3DObject( thisSectionNode );
                    objItemDesire.position.copy(thisPosition);
                    objItemDesire.lookAt(faceTarget);

                    cv_objects[cvitem_name+"Objects"].push(object);
                    cv_objects[cvitem_name+"Desired"].push(objItemDesire);

                }

                //title for cv-section
                else{
                    var thisNode = document.createElement("div");
                    thisNode.className = cvitem_name +"-" + cvsection_name;
                    thisNode.textContent = "返回";
                    //thisNode.textContent = SectionObject[cvsection_name];
                    thisSectionNode.appendChild(thisNode);
                }

            }

        }

        //cv-basic infos such as name, title, self-intro
        else{
            var thisNode = document.createElement("div");
            thisNode.className = "namecard-"+cvitem_name;

            thisNode.textContent = cv[cvitem_name];
            namecardNode.appendChild(thisNode);
        }
    }

    var object = new THREE.CSS3DObject( namecardNode );
    object.position.x = 0;
    object.position.y = 0;
    object.position.z = 6000;
    scene.add( object );

    var object = new THREE.Object3D();
    object.position.x = 0;
    object.position.y = 0;
    object.position.z = 6000;
    
}